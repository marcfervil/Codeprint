
<html>
    <!doctype html>
    <head>
        <title>Gizmo</title>
        <link rel="stylesheet" href="zen.css">
        <link rel="preconnect" href="https://fonts.gstatic.com"> 

        <link rel="preconnect" href="https://fonts.gstatic.com"> 
        <link rel="preconnect" href="https://fonts.gstatic.com"> 
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@500&family=Roboto&family=Source+Sans+Pro&display=swap" rel="stylesheet">
   

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css" integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk" crossorigin="anonymous">
</head>

    <body>

        <button style="position: fixed; z-index: 5;bottom: 10px; right: 10px" onclick="preview()">Preview</button>
        
        <div id="app">
            
           
            <div id="menu-items" class="menu" >

                <h2 style="margin-top: 5; padding: 10px 0px 0px 10px;">Gizmo </h2>
                
                
                <zen-shelf id="gizmo-menu-drawer" style=" border-top: 1px solid #CED4DA;" text='Gizmos'></zen-shelf>
            
                <zen-shelf id="event-menu-drawer" text="Events"></zen-shelf>
               
                <zen-shelf id="action-menu-drawer" text="Actions"></zen-shelf>
                

                

            </div>
            <div class="blueprintArea" id="bparea">
                <div class="blueprintContainer" id="bp"></div>
            </div>
            
            <div class="preview" id="preview"></div>

            
            
            <!--
                <svg style="position: fixed; left:100; background-color:red" id="svgenius">
                    
                </svg>
            -->
            
            
        </div>
    </body>
    
</html>
<script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
<script type="text/javascript" src="util.js"></script>
<script type="text/javascript" src="notifier.js"></script>
<script type="text/javascript" src="editor.js"></script>
<script type="text/javascript" src="gizmos.js"></script>
<script type="text/javascript" src="blueprint.js"></script>
<script type="text/javascript" src="action.js"></script>
<script type="text/javascript" src="event.js"></script>
<script type="text/javascript" src="ui.js"></script>
<script type="text/javascript">
document.isPreview = false;

    initGizmos();
    initMenu();



    let defaultView = new ViewGizmo();
    let defaultText = new TextGizmo();


    $("#bp").append(defaultView);
    defaultView.addGizmo(defaultText)
    defaultView.addGizmo(new TextBoxGizmo())
    defaultView.addGizmo(new ButtonGizmo())
    defaultView.pos(344, 160);
    //defaultText.createBlueprint();
    let viewbp = defaultView.createBlueprint();
    viewbp.pos(822, 116)
    defaultView.redrag()

    let renderer = new StartGizmo()
    $("#bp").append(renderer)

   

    renderer.redrag()
    renderer.pos(1000, 87)


 
   viewbp.hooks[0].hook(renderer.hooks[0])
   

   function preview(){
        let newWindow  = window.open("preview.html", null, "height=400,width=500,status=yes,toolbar=no,menubar=no,location=no");  
       // let c = $("<div/>");
       //newWindow.document.write('html to write...'); 
       
       document.isPreview = true;
        //console.log(newWindow.document.body.isPreview);
        newWindow.customElements = customElements;
    

        //x = newWindow.document.createElement("div")
       // console.log(document.getElementById("preview").firstChild)
        let rootGizmo = document.getElementById("preview").firstChild//.cloneNode(true);
        //newWindow.document.body.appendChild(rootGizmo)
        
        $(rootGizmo).css({
            width: "100%",
            height: "100%"
        })
        newWindow.onunload= function (e) {
            setTimeout(()=>{
                
                if(newWindow.closed){
                    document.getElementById("preview").appendChild(rootGizmo);
                }
            },100)
        };

        //newWindow
        //newWindow.document.body.appendChild(new TextGizmo())
        document.isPreview = false;

        setTimeout(()=>{
            newWindow.document.body.innerHTML = '';
            newWindow.document.body.appendChild(rootGizmo)
    // Your code to run since DOM is loaded and ready
        
    },1000)
           
        //
       // newWindow.document.body.innerText += "owkf";
       
    //    newWindow.document.write("fpewkpk")
    //    newWindow.document.write(" hiii")
      //  c.append($("#preview"));
   }
    
</script>